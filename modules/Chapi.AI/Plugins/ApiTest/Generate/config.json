{
  "schema": 1,
  "description": "Generates a Chapi chat card (plan + generated files + actions) for 'Generate smoke tests…' using EndpointCatalog context. Returns STRICT JSON only.",
  "execution_settings": {
    "gpt-4o": {
      "model_id": "gpt-4o",
      "service_id": "gpt-4o",
      "temperature": 0.1,
      "text_format": "json",
      "store": false,
      "response_format": {
        "type": "json_schema",
        "json_schema": {
          "name": "ChapiCard",
          "strict": true,
          "schema": {
            "type": "object",
            "properties": {
              "role": { "type": "string", "enum": ["Chapi"] },
              "heading": { "type": "string" },
              "plan": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 8
              },
              "files": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": { "type": "string" },
                    "addedLines": { "type": "integer", "minimum": 1 }
                  },
                  "required": ["path", "addedLines"],
                  "additionalProperties": false
                },
                "minItems": 1
              },
              "actions": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["RUN_CLOUD", "DOWNLOAD_RUN_PACK", "ADD_NEGATIVES"]
                }
              }
            },
            "required": ["role", "heading", "plan", "files", "actions"],
            "additionalProperties": false
          }
        }
      }
    }
  },
  "input_variables": [
    {
      "name": "user_query",
      "description": "What the user asked for (e.g., 'Generate smoke tests for our user service API').",
      "required": true
    },
    {
      "name": "endpoints_context",
      "description": "Compact text listing relevant API endpoints from the EndpointCatalog (method, path, brief summary, auth, request type).",
      "required": true
    },
    {
      "name": "max_files",
      "description": "Maximum number of test files to propose (1–3).",
      "required": false
    }
    ,
    {
      "name": "openApiJson",
      "description": "The OpenAPI document JSON for the target API (full text).",
      "required": false
    }
  ],
  "messages": [
    {
      "role": "system",
      "content": "You are Chapi, an API test generator. Return ONLY a JSON object that conforms exactly to the provided JSON Schema. Plan briefly, then propose 1–3 test files with rough line counts. Prefer application/json, cover auth + CRUD + simple edge validations."
    },
    { "role": "user", "content": "User asked: {{user_query}}" },
    { "role": "assistant", "content": "Context follows." },
    { "role": "user", "content": "{{endpoints_context}}" },
    { "role": "user", "content": "OpenAPI document: {{openApiJson}}" }
  ],
  "defaults": {
    "max_files": 3
  }
}
